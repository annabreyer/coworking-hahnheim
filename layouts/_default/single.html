<!-- 5. MODIFIED layouts/_default/single.html -->
{{ define "main" }}
<main class="content single-page" role="main">

    <!-- Include enhanced header -->
    {{ partial "enhanced-header.html" . }}

    <!-- Include breadcrumb -->
    {{ partial "enhanced-breadcrumb.html" . }}

    <!-- Content Area with Sidebar -->
    <div class="content-area">
        <!-- Include sidebar -->
        {{ partial "content-sidebar.html" . }}

        <!-- Main Content -->
        <article class="main-content">
            <div class="content-header">
                <h1 class="post-title">{{ .Title | htmlEscape }}</h1>
                {{ if .Params.show_meta | default true }}
                <div class="content-meta">
                    {{ with .Params.author | default .Site.Params.author }}
                    <span><i class="fas fa-user"></i>{{ . }}</span>
                    {{ end }}
                    {{ with .ReadingTime }}
                    <span><i class="fas fa-clock"></i>{{ . }} Min. Lesezeit</span>
                    {{ end }}
                    {{ with .Params.category }}
                    <span><i class="fas fa-tag"></i>{{ . }}</span>
                    {{ end }}
                </div>
                {{ end }}
            </div>

            <div class="content-body">
                {{ .Content }}
            </div>

            <!-- Include related articles -->
            {{ partial "related-articles.html" . }}
        </article>
    </div>
</main>

<!-- Enhanced JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mega menu functionality
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            const menu = item.querySelector('.mega-menu');
            if (menu) {
                let timeout;

                item.addEventListener('mouseenter', function() {
                    clearTimeout(timeout);
                    menu.style.opacity = '1';
                    menu.style.visibility = 'visible';
                });

                item.addEventListener('mouseleave', function() {
                    timeout = setTimeout(() => {
                        menu.style.opacity = '0';
                        menu.style.visibility = 'hidden';
                    }, 200);
                });
            }
        });

        // Mobile menu toggle
        const burgerMenu = document.getElementById('burgerMenu');
        const mainNav = document.querySelector('.main-nav');

        if (burgerMenu) {
            burgerMenu.addEventListener('click', function() {
                mainNav.classList.toggle('mobile-open');
                burgerMenu.classList.toggle('open');
            });
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Reading progress indicator
        function updateReadingProgress() {
            const article = document.querySelector('.main-content');
            if (!article) return;

            const scrolled = window.pageYOffset;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const progress = Math.min(scrolled / (articleHeight - windowHeight), 1);

            let progressBar = document.querySelector('.reading-progress');
            if (!progressBar) {
                progressBar = document.createElement('div');
                progressBar.className = 'reading-progress';
                document.body.appendChild(progressBar);
            }

            progressBar.style.width = (progress * 100) + '%';
        }

        // Update reading progress on scroll
        window.addEventListener('scroll', updateReadingProgress);
        updateReadingProgress();
    });
</script>
{{ end }}